"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const commander_1 = __importDefault(require("commander"));
const CommandsLogic_1 = __importDefault(require("../CommandsLogic"));
const GSNConfigurator_1 = require("../../relayclient/GSNConfigurator");
const utils_1 = require("../utils");
const Environments_1 = require("../../common/Environments");
utils_1.gsnCommander(['n', 'f', 'm', 'g'])
    .option('-w, --workdir <directory>', 'relative work directory (defaults to build/gsn/)', 'build/gsn')
    .option('--forwarder <address>', 'address of forwarder deployed to the current network (optional; deploys new one by default)')
    .option('-c, --config <mnemonic>', 'config JSON file to change the configuration of the RelayHub being deployed (optional)')
    .parse(process.argv);
(async () => {
    var _a, _b;
    const network = commander_1.default.network;
    const nodeURL = utils_1.getNetworkUrl(network);
    const mnemonic = utils_1.getMnemonic(commander_1.default.mnemonic);
    const relayHubConfiguration = (_a = utils_1.getRelayHubConfiguration(commander_1.default.config)) !== null && _a !== void 0 ? _a : Environments_1.defaultEnvironment.relayHubConfiguration;
    const logic = new CommandsLogic_1.default(nodeURL, GSNConfigurator_1.configureGSN({}), mnemonic);
    const from = (_b = commander_1.default.from) !== null && _b !== void 0 ? _b : await logic.findWealthyAccount();
    const gasPrice = commander_1.default.gasPrice;
    const deploymentResult = await logic.deployGsnContracts({
        from,
        gasPrice,
        relayHubConfiguration,
        deployPaymaster: true,
        forwarderAddress: commander_1.default.forwarder
    });
    const paymasterName = 'Default';
    utils_1.showDeployment(deploymentResult, `Deployed GSN to network: ${network}`, paymasterName);
    utils_1.saveDeployment(deploymentResult, commander_1.default.workdir);
    process.exit(0);
})().catch(reason => {
    console.error(reason);
    process.exit(1);
});
//# sourceMappingURL=gsn-deploy.js.map